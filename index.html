<script>
  const cards = {
    "sun.jpg": "希望と光の象徴。あなたの未来は明るい！",
    "moon.jpg": "直感を信じてください。答えはあなたの中にあります。",
    "star.jpg": "願いが叶う時。ポジティブなエネルギーがあなたを包みます。",
    "tower.jpg": "変化の時。過去を手放し、新たな道へ進みましょう。"
  };

  function spreadDeck() {
    const deckCards = document.querySelectorAll('.deck-card');
    let spacing = window.innerWidth < 600 ? 80 : 200;
    deckCards.forEach((card, index) => {
      card.style.left = spacing * index + "px";
      card.style.top = "0px"; // **リセット時に高さも戻す**
      card.style.transform = "rotateY(0deg) scale(1)";
      card.style.opacity = "1";
      card.style.pointerEvents = "auto"; // **カードを再び選べるように**
    });
  }

  window.onload = function() {
    setTimeout(spreadDeck, 1000);
  };

  document.getElementById("chooseButton").addEventListener("click", resetDeck);

  document.querySelectorAll('.deck-card').forEach(card => {
    card.addEventListener('click', function() {
      document.querySelectorAll('.deck-card').forEach(c => c.style.pointerEvents = "none");

      const cardKeys = Object.keys(cards);
      const randomFront = cardKeys[Math.floor(Math.random() * cardKeys.length)];
      this.querySelector('.card-front img').src = randomFront;

      this.style.transition = "transform 0.6s ease, left 0.6s ease, top 0.6s ease";
      this.style.transform = "rotateY(180deg) scale(1.3)";
      this.style.left = "270px";
      this.style.top = "30px";
      this.style.zIndex = "999";

      document.querySelectorAll('.deck-card').forEach(c => {
        if (c !== this) {
          c.style.transform = "scale(0.5)";
          c.style.opacity = "0";
        }
      });

      setTimeout(() => {
        document.getElementById("cardMessage").textContent = cards[randomFront];
        document.getElementById("cardMessage").style.display = "block";
        document.getElementById("rechooseButton").style.display = "inline-block";
        document.getElementById("chooseButton").style.display = "none";
      }, 600);
    });
  });

  function resetDeck() {
    document.getElementById("cardMessage").style.display = "none";
    document.getElementById("rechooseButton").style.display = "none";
    document.getElementById("chooseButton").style.display = "inline-block";

    document.querySelectorAll('.deck-card').forEach(card => {
      card.style.transition = "transform 0.6s ease, left 0.6s ease, opacity 0.6s ease";
      card.style.transform = "rotateY(0deg) scale(1)";
      card.style.opacity = "1";
      card.style.left = "0px"; // **リセット時に初期位置に戻す**
      card.style.top = "0px"; // **高さもリセット**
      card.style.pointerEvents = "auto"; // **カードを選べるように**
    });

    setTimeout(spreadDeck, 600);
  }

  document.getElementById("rechooseButton").addEventListener("click", resetDeck);
</script>
